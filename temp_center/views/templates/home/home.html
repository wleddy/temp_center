{% extends "layout.html" %}
{% block title %}{{ g.title }}{% endblock %}
{% block body %}
<style>
    table,
    th,
    td {
        border: 0px solid black;
        border-bottom: 2px solid red;
        border-collapse: collapse;
        padding:0pt 12pt;
        background-color: black;
    }
    .big, .scale {
        font-weight:bold;
        color:aquamarine;
        text-align: center;
        font-size: 18pt;

    }
    .big {font-size:36pt;}
    .scale {
        vertical-align: top;
        position: relative;
        top: 6pt;
    }
    .device_name {
        text-align: center;
        color:black;
        background-color:white;
    }
    .name, .hi, .lo {
        font-weight:normal;
        color:white;
        vertical-align: top;
        position: relative;
    }
    .lo, .hi {
        font-size:20pt;
        margin:0;
        line-height:.8;
    }
    .lo {color:deepskyblue;padding-right:6pt;}
    .hi {color:red;padding-left:6pt;top:-2px;}

    @media (prefers-color-scheme: dark) {
        .device_name {
            text-align: center;
            color:white;
            background-color:rgb(122, 120, 120);
    }
</style>

{% set row_name = [""] %}
{% if data %}
    <div style="margin: auto;width:fit-content;" >
    <table>
    {% for row in data %}
        {% if row_name[0] != row.device_name %}
            {% set _ = row_name.pop() %}{% set _ = row_name.append(row.device_name) %}
            <tr >
            <td colspan="2" class="device_name">
                <h2 >{{row.device_name}}</h2></td>
            </tr>
            <tr>
                <td  colspan="2" >
                    <h3 class="big">
                        {{row.reading_time | local_time_string }}
                    </h3>
                </td>
            </tr>

        {% endif %}
         <tr>
            <td>
                <h3 class="name">{{row.sensor_name}}</h3>
                <h3>
                    <span class='lo'>{{row.min_temp | int | default('?',True)}}</span>
                    <span class='hi'>{{row.max_temp | int | default('?',True)}}</span>
                </h3>
            </td>
            <td>
                <h3 class="big">
                    {{row.temperature}}
                    <span class="scale">{{row.scale}}</span>
                </h3>
            </td>
        </tr>
    {% endfor %}
    </table>
   {% if history %}
    <div id="history">
        {% set sensor_name = [""] %}
        <!-- Set the number of pix per degree F -->
        {% set pixPerDegree = 60 / (history[0].weeklyMax + history[0].weeklyMin) %}
        {% set rangeHeight = 60 %}
        <p>{{pixPerDegree}}</p>
        <div>
        {% for row in history %}
        {% if row.name != sensor_name[0] %}
            {% set x = sensor_name.append(row.name) %}
            {% set x = sensor_name.pop(0) %}
            </div>
            <h4 class="w3-row">{{sensor_name[0]}}</h4>
            <div class="w3-row" style="border: solid 1pt black;">
        {%endif%}
        <div class="w3-col" style="width: 14.28%;"
            title="{{row.date}}, Max: {{'%0.2f'|format(row.max)}}, Min: {{'%0.2f'|format(row.min)}}">
                <p class="w3-row" style="text-align: center;size:9pt;margin-bottom:0;">{{'%0.0f'|format(row.max)}}</p>
                <p class="top-spacer" style="background:transparent;height:{{(rangeHeight - ((row.max + row.min)*pixPerDegree)) | abs | round(0) }}px;margin:0;padding:0;">&nbsp;</p>
                <p class="w3-row" style="background-image: linear-gradient(red, blue);height:{{(row.max + row.min) * pixPerDegree}}px;margin:0 3pt;">&nbsp;</p>
                <p class="w3-row" style="text-align: center;size:9pt;">{{'%0.0f'|format(row.min)}}</p>
           </div>
        {% endfor %}
        </div>
    </div>
</div>
 
    {% endif %}
{% else %}
    <h2>Sorry, there is no data to report...</h2>
{% endif %}

{% endblock body %}